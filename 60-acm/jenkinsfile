pipeline{
    agent{
        label "AGENT-1"
    }
    environment{
        COURSE = "jenkins"
        appVersion = ""
        region = "us-east-1"
        ACC_ID = "911893329385"
        PROJECT = "roboshop"
        COMPONENT = "catalogue"        
    }
    options{
        timeout(time:30, unit:"MINUTES")
        disableConcurrentBuilds()
        ansiColor()
    }
    stages{
        stage("init"){
            steps{
                script{
                    withAWS(credentials:"aws-creds", region:"us-east-1"){
                        sh """
                            cd 60-acm
                            terraform init -reconfigure
                        """            
                    }
                }
            }
        }
        stage("plan"){
            steps{
                script{
                    withAWS(credentials:"aws-creds", region:"us-east-1"){
                        sh """
                            cd 60-acm
                            terraform plan
                        """            
                    }
                }
            }
        }
        stage("apply"){
            steps{
                script{
                    withAWS(credentials:"aws-creds")
                    sh """
                        cd 60-acm
                        terraform apply -auto-approve
                    """
                }
            }
        }
    }
    post{
        always{
            echo "hello from always"
        }
        success{
            echo "hello from success"
        }
        failure{
            echo "hello from failure"
        }
    }
}